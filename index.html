<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Last Call Home Solutions LLC – Invoice Form</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 8px;
  }
  h1, h2, h3 {
    text-align: center;
    margin-bottom: 10px;
  }
  .header-info, .footer {
    text-align: center;
    margin-bottom: 20px;
  }
  .section {
    margin-bottom: 30px;
  }
  label {
    font-weight: bold;
  }
  input, textarea, select {
    width: 100%;
    padding: 6px;
    margin-top: 4px;
    margin-bottom: 10px;
  }
  .line-item {
    border: 1px solid #bbb;
    padding: 15px;
    margin-top: 10px;
    border-radius: 5px;
  }
  button {
    background: #1e73be;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover {
    background: #155b91;
  }
  hr {
    border: 1px solid #ccc;
    margin: 30px 0;
  }
</style>
</head>
<body>
  <!-- HEADER -->
  <h1><b>Last Call Home Solutions LLC</b></h1>
  <div class="header-info">
    <label>Address:</label>
    <input type="text" id="company_address" value="1234 Example Street, City, State ZIP" />

    <label>Phone:</label>
    <input type="text" id="company_phone" value="(555) 123-4567" />

    <label>Email:</label>
    <input type="email" id="company_email" value="info@lastcallhomesolutions.com" />

    <p><em>“Last call you’ll make for all your contracting and remodeling needs.”</em></p>
  </div>

  <!-- FORM -->
  <form id="invoiceForm">
    <!-- Header Info -->
    <div class="section">
      <h2>Invoice Information</h2>
      <label for="invoice_date">Invoice Date:</label>
      <input type="date" id="invoice_date" name="invoice_date" required />

      <label for="invoice_number">Invoice #:</label>
      <input type="text" id="invoice_number" name="invoice_number" required />
    </div>

    <!-- Top Info -->
    <div class="section">
      <h2>Project & Payment Info</h2>
      <label for="salesperson">Salesperson Name:</label>
      <input type="text" id="salesperson" name="salesperson" placeholder="Dennis Call" required />

      <label for="job">Job Name or Address:</label>
      <input type="text" id="job" name="job" placeholder="Kitchen Remodel, Tampa FL" required />

      <label for="payment_terms"><strong>Payment Terms:</strong></label>
      <textarea id="payment_terms" rows="2">Deposit of 50% prior to work commencing and weekly progress payments.</textarea>

      <label for="approx_weeks">Approximate Working Weeks:</label>
      <input type="number" id="approx_weeks" name="approx_weeks" min="1" value="4" required />
    </div>

    <!-- Dynamic Line Items -->
    <div class="section">
      <h2>Line Items</h2>
      <label for="num_line_items">How many line items (trades)?</label>
      <input type="number" id="num_line_items" min="1" max="20" required />
      <button type="button" id="generateBtn">Generate Line Item Sections</button>
      <div id="lineItemsContainer"></div>
    </div>

    <!-- Contingency -->
    <div class="section">
      <h2>Contingency (10%)</h2>
      <textarea id="contingency_coverage" rows="3">Miscellaneous material and unforeseen circumstances; screws, nails, latex, interior doorknobs, kitchen handles/doorknobs, stucco repair, shower/tub fixtures, etc.</textarea>
      <p><strong>CONTINGENCY FUNDS NOT UTILIZED WILL BE RETURNED TO THE CUSTOMER.</strong></p>
    </div>

    <!-- Totals -->
    <div class="section">
      <h2>Totals & Payment</h2>
      <label for="total_costs">Total Costs (tax percentage included):</label>
      <input type="number" step="0.01" id="total_costs" name="total_costs" placeholder="0.00" required />

      <label for="deposit_required">Deposit Required:</label>
      <input type="number" step="0.01" id="deposit_required" name="deposit_required" placeholder="0.00" required />

      <label for="weekly_payments">Weekly Progress Payments × ____ (beginning second working week):</label>
      <input type="number" id="weekly_payments" name="weekly_payments" min="0" placeholder="Enter number of weekly payments" required />

      <label for="final_amount_due">Final Amount Due Upon Completion:</label>
      <input type="number" step="0.01" id="final_amount_due" name="final_amount_due" placeholder="0.00" />

      <p><strong>Clause:</strong> Payment will not exceed amount shown in contract unless all parties agree to addendum.</p>
    </div>

    <!-- Customer -->
    <div class="section">
      <h2>Customer Info</h2>

      <label for="customer_name">Customer Name:</label>
      <input type="text" id="customer_name" name="customer_name" placeholder="Customer Full Name" required />

      <label for="customer_address">Customer Address:</label>
      <input type="text" id="customer_address" name="customer_address" placeholder="123 Main Street, City, State ZIP" required />

      <label for="customer_phone">Customer Phone:</label>
      <input type="text" id="customer_phone" name="customer_phone" placeholder="(555) 987-6543" required />

      <label for="customer_email">Customer Email:</label>
      <input type="email" id="customer_email" name="customer_email" placeholder="customer@email.com" required />
    </div>

    <hr />

    <button type="button" id="submitBtn">Generate My Bid</button>
  </form>

  <script>
    const container = document.getElementById("lineItemsContainer");
    const generateBtn = document.getElementById("generateBtn");
    const submitBtn = document.getElementById("submitBtn");
    const invoiceForm = document.getElementById("invoiceForm");

    // Generate dynamic line items
    generateBtn.addEventListener("click", () => {
      container.innerHTML = "";
      const count = parseInt(document.getElementById("num_line_items").value);
      if (!count || count < 1) return alert("Enter a valid number of line items.");

      for (let i = 1; i <= count; i++) {
        const div = document.createElement("div");
        div.classList.add("line-item");
        div.innerHTML = `
          <h3>${i} LINE ITEM</h3>
          <label>Trade Name:</label>
          <input type="text" name="trade_${i}" placeholder="e.g., Plumbing, Drywall" required />

          <label>Scope of Work (one per line):</label>
          <textarea name="scope_${i}" rows="3" placeholder="- Remove existing supply lines&#10;- Install new PEX runs to kitchen and hall bath" required></textarea>

          <label>Material and Labor Included?</label>
          <select name="mat_labor_${i}">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
          </select>

          <label>Line Total ($):</label>
          <input type="number" step="0.01" name="line_total_${i}" placeholder="0.00" required />
        `;
        container.appendChild(div);
      }
    });

    // Popup display
    function showPopup(message, success = true) {
      const popup = document.createElement("div");
      popup.style.position = "fixed";
      popup.style.top = "0";
      popup.style.left = "0";
      popup.style.width = "100%";
      popup.style.height = "100%";
      popup.style.background = "rgba(0,0,0,0.4)";
      popup.style.display = "flex";
      popup.style.justifyContent = "center";
      popup.style.alignItems = "center";
      popup.style.zIndex = "1000";

      const box = document.createElement("div");
      box.style.background = "#fff";
      box.style.padding = "30px 40px";
      box.style.borderRadius = "10px";
      box.style.textAlign = "center";
      box.style.fontSize = "18px";
      box.style.color = success ? "green" : "red";
      box.style.boxShadow = "0 2px 10px rgba(0,0,0,0.2)";
      box.innerText = message;

      popup.appendChild(box);
      document.body.appendChild(popup);

      setTimeout(() => popup.remove(), 2000);
    }

    // Submit button triggers webhook
    submitBtn.addEventListener("click", async () => {
      const numItems = parseInt(document.getElementById("num_line_items").value);
      const lineItems = [];
      for (let i = 1; i <= numItems; i++) {
        const trade = document.querySelector(`[name=trade_${i}]`)?.value;
        const scopeText = document.querySelector(`[name=scope_${i}]`)?.value || "";
        const scope = scopeText.split(/\r?\n/).filter(Boolean);
        const matLabor = document.querySelector(`[name=mat_labor_${i}]`)?.value || "Yes";
        const lineTotal = parseFloat(document.querySelector(`[name=line_total_${i}]`)?.value || 0);
        lineItems.push({ trade, scope, material_labor_included: matLabor, line_total: lineTotal });
      }

      const data = {
        company_address: document.getElementById("company_address").value,
        company_phone: document.getElementById("company_phone").value,
        company_email: document.getElementById("company_email").value,
        invoice_date: document.getElementById("invoice_date").value,
        invoice_number: document.getElementById("invoice_number").value,
        salesperson: document.getElementById("salesperson").value,
        job: document.getElementById("job").value,
        payment_terms: document.getElementById("payment_terms").value,
        approx_weeks: parseInt(document.getElementById("approx_weeks").value),
        line_items: lineItems,
        contingency_coverage: document.getElementById("contingency_coverage").value,
        total_costs: parseFloat(document.getElementById("total_costs").value),
        deposit_required: parseFloat(document.getElementById("deposit_required").value),
        weekly_payments: parseInt(document.getElementById("weekly_payments").value),
        final_amount_due: parseFloat(document.getElementById("final_amount_due").value || 0),
        customer_name: document.getElementById("customer_name").value,
        customer_address: document.getElementById("customer_address").value,
        customer_phone: document.getElementById("customer_phone").value,
        customer_email: document.getElementById("customer_email").value
      };

      try {
        const response = await fetch("https://astutearc7.app.n8n.cloud/webhook-test/lastcall-bid", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          showPopup("✅ Bid submitted successfully!");
          invoiceForm.reset();
          container.innerHTML = "";
          window.scrollTo({ top: 0, behavior: "smooth" });
        } else {
          showPopup("❌ Error submitting bid.", false);
        }
      } catch (err) {
        console.error(err);
        showPopup("⚠️ Network error. Please try again.", false);
      }
    });
  </script>
</body>
</html>
